# RNA seq Variant calling 

#STAR 2-pass 
cat config | while read id 
do
STAR \
--runThreadN 6 \
--genomeDir ../ref/STAR_index_GRCh38_ENSEMBL102 \
--twopassMode Basic \
--readFilesIn ../clean_fq/${id}_R1_val_1.fq.gz ../clean_fq/${id}_R2_val_2.fq.gz \
--readFilesCommand zcat \
--sjdbOverhang 150 \
--outSAMtype BAM Unsorted \
--chimOutType SeparateSAMold \
--quantMode GeneCounts \
--outFileNamePrefix ./2-pass/${id}
 done

#picard AddOrReplaceReadGroups
cat config | while read id 
do
picard AddOrReplaceReadGroups \
I=./STAR/2-pass/${id}Aligned.out.bam \
O=./STAR/2-pass/${id}_sorted.bam \
SO=coordinate RGID=${id} RGLB=mRNA RGPL=illumina RGPU=HiSeq2500 RGSM=${id}
done

#picard MarkDuplicates
cat config | while read id 
do
picard MarkDuplicates \
I=./STAR/2-pass/${id}_sorted.bam \
O=./STAR/2-pass/${id}_sorted_maked.bam \
CREATE_INDEX=true \
VALIDATION_STRINGENCY=SILENT \
METRICS_FILE=./STAR/2-pass/${id}.metrics
done

picard CreateSequenceDictionary \
R=./ref/Homo_sapiens.GRCh38.dna.primary_assembly.fa \
O=./ref/Homo_sapiens.GRCh38.dna.primary_assembly.dict 

# !!! conda install samtools==1.11
samtools faidx Homo_sapiens.GRCh38.dna.primary_assembly.fa 

#gatk SplitNCigarReads
cat config | while read id
do
gatk SplitNCigarReads \
-R ./ref/Homo_sapiens.GRCh38.dna.primary_assembly.fa \
-I ./STAR/2-pass/${id}_sorted_maked.bam \
-O ./STAR/2-pass/${id}_sorted_maked_split.bam
done

#
